# Estructura de la Base de Datos - Restaurant Reservation API

## ğŸ“Š Diagrama de Relaciones

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    districts    â”‚       â”‚   restaurants   â”‚       â”‚  reservations   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â”€â”€â”€â”€â”€â”€â–·â”‚ district_id (FK)â”‚       â”‚ restaurant_id   â”‚
â”‚ name            â”‚       â”‚ id (PK)         â”‚â”€â”€â”€â”€â”€â”€â–·â”‚ (FK)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ name            â”‚       â”‚ id (PK)         â”‚
                          â”‚ address         â”‚       â”‚ client_id (FK)  â”‚â—â”€â”€â”
                          â”‚ phone_number    â”‚       â”‚ reservation_dateâ”‚   â”‚
                          â”‚ email           â”‚       â”‚ number_of_peopleâ”‚   â”‚
                          â”‚ price_per_personâ”‚       â”‚ total_amount    â”‚   â”‚
                          â”‚ capacity        â”‚       â”‚ status          â”‚   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ additional_info â”‚   â”‚
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                                                          â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
                          â”‚     users       â”‚                            â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
                          â”‚ id (PK)         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ first_name      â”‚
                          â”‚ last_name       â”‚
                          â”‚ email           â”‚
                          â”‚ password        â”‚
                          â”‚ role            â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— Relaciones de Foreign Keys

### 1. **restaurants.district_id â†’ districts.id** (Muchos a Uno)
- Un distrito puede tener mÃºltiples restaurantes
- Un restaurante pertenece a un solo distrito
- **Constraint**: `FK_restaurant_district`

### 2. **reservations.restaurant_id â†’ restaurants.id** (Muchos a Uno)
- Un restaurante puede tener mÃºltiples reservaciones
- Una reservaciÃ³n pertenece a un solo restaurante
- **Constraint**: `FK2tl2cjtd2o3o0nfeekcqfvt70`

### 3. **reservations.client_id â†’ users.id** (Muchos a Uno)
- Un usuario puede tener mÃºltiples reservaciones
- Una reservaciÃ³n pertenece a un solo usuario
- **Constraint**: `FKa8dyjs5cb5gl9chfumr06fsgn`

## ğŸ“‹ DefiniciÃ³n de Tablas

### districts
```sql
CREATE TABLE districts (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);
```

### restaurants
```sql
CREATE TABLE restaurants (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(255) NOT NULL,
    phone_number VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    price_per_person FLOAT(53) NOT NULL,
    capacity INTEGER NOT NULL,
    district_id BIGINT NOT NULL,
    FOREIGN KEY (district_id) REFERENCES districts(id)
);
```

### users
```sql
CREATE TABLE users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(255) CHECK (role IN ('ADMIN','USER'))
);
```

### reservations
```sql
CREATE TABLE reservations (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    client_id BIGINT NOT NULL,
    restaurant_id BIGINT NOT NULL,
    reservation_date TIMESTAMP(6) NOT NULL,
    number_of_people INTEGER NOT NULL,
    total_amount FLOAT(53) NOT NULL,
    status VARCHAR(255) NOT NULL CHECK (status IN ('PENDING','PAID')),
    additional_info VARCHAR(255),
    FOREIGN KEY (client_id) REFERENCES users(id),
    FOREIGN KEY (restaurant_id) REFERENCES restaurants(id)
);
```

## ğŸ¯ Ejemplos de Consultas con Relaciones

### 1. Obtener restaurantes con sus distritos
```sql
SELECT r.name, r.address, d.name as district_name
FROM restaurants r
JOIN districts d ON r.district_id = d.id;
```

### 2. Obtener reservaciones con informaciÃ³n completa
```sql
SELECT 
    res.id,
    u.first_name || ' ' || u.last_name as client_name,
    rest.name as restaurant_name,
    d.name as district_name,
    res.reservation_date,
    res.number_of_people,
    res.total_amount,
    res.status
FROM reservations res
JOIN users u ON res.client_id = u.id
JOIN restaurants rest ON res.restaurant_id = rest.id
JOIN districts d ON rest.district_id = d.id;
```

### 3. Contar reservaciones por distrito
```sql
SELECT 
    d.name as district_name,
    COUNT(res.id) as total_reservations
FROM districts d
LEFT JOIN restaurants rest ON d.id = rest.district_id
LEFT JOIN reservations res ON rest.id = res.restaurant_id
GROUP BY d.id, d.name;
```

## ğŸ”’ Integridad Referencial

âœ… **Todas las foreign keys estÃ¡n configuradas con restricciones CASCADE**
âœ… **Los datos de ejemplo respetan la integridad referencial**
âœ… **Hibernate maneja automÃ¡ticamente las relaciones**

## ğŸ“Š Datos de Ejemplo Incluidos

- **20 distritos** mexicanos
- **30 restaurantes** con relaciÃ³n a distritos
- **6 usuarios** de ejemplo
- **10 reservaciones** con relaciones a usuarios y restaurantes
