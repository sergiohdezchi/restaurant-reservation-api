# Estructura de la Base de Datos - Restaurant Reservation API

## 📊 Diagrama de Relaciones

```
┌─────────────────┐       ┌─────────────────┐       ┌─────────────────┐
│    districts    │       │   restaurants   │       │  reservations   │
├─────────────────┤       ├─────────────────┤       ├─────────────────┤
│ id (PK)         │──────▷│ district_id (FK)│       │ restaurant_id   │
│ name            │       │ id (PK)         │──────▷│ (FK)            │
└─────────────────┘       │ name            │       │ id (PK)         │
                          │ address         │       │ client_id (FK)  │◁──┐
                          │ phone_number    │       │ reservation_date│   │
                          │ email           │       │ number_of_people│   │
                          │ price_per_person│       │ total_amount    │   │
                          │ capacity        │       │ status          │   │
                          └─────────────────┘       │ additional_info │   │
                                                    └─────────────────┘   │
                                                                          │
                          ┌─────────────────┐                            │
                          │     users       │                            │
                          ├─────────────────┤                            │
                          │ id (PK)         │───────────────────────────┘
                          │ first_name      │
                          │ last_name       │
                          │ email           │
                          │ password        │
                          │ role            │
                          └─────────────────┘
```

## 🔗 Relaciones de Foreign Keys

### 1. **restaurants.district_id → districts.id** (Muchos a Uno)
- Un distrito puede tener múltiples restaurantes
- Un restaurante pertenece a un solo distrito
- **Constraint**: `FK_restaurant_district`

### 2. **reservations.restaurant_id → restaurants.id** (Muchos a Uno)
- Un restaurante puede tener múltiples reservaciones
- Una reservación pertenece a un solo restaurante
- **Constraint**: `FK2tl2cjtd2o3o0nfeekcqfvt70`

### 3. **reservations.client_id → users.id** (Muchos a Uno)
- Un usuario puede tener múltiples reservaciones
- Una reservación pertenece a un solo usuario
- **Constraint**: `FKa8dyjs5cb5gl9chfumr06fsgn`

## 📋 Definición de Tablas

### districts
```sql
CREATE TABLE districts (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);
```

### restaurants
```sql
CREATE TABLE restaurants (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(255) NOT NULL,
    phone_number VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    price_per_person FLOAT(53) NOT NULL,
    capacity INTEGER NOT NULL,
    district_id BIGINT NOT NULL,
    FOREIGN KEY (district_id) REFERENCES districts(id)
);
```

### users
```sql
CREATE TABLE users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(255) CHECK (role IN ('ADMIN','USER'))
);
```

### reservations
```sql
CREATE TABLE reservations (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    client_id BIGINT NOT NULL,
    restaurant_id BIGINT NOT NULL,
    reservation_date TIMESTAMP(6) NOT NULL,
    number_of_people INTEGER NOT NULL,
    total_amount FLOAT(53) NOT NULL,
    status VARCHAR(255) NOT NULL CHECK (status IN ('PENDING','PAID')),
    additional_info VARCHAR(255),
    FOREIGN KEY (client_id) REFERENCES users(id),
    FOREIGN KEY (restaurant_id) REFERENCES restaurants(id)
);
```

## 🎯 Ejemplos de Consultas con Relaciones

### 1. Obtener restaurantes con sus distritos
```sql
SELECT r.name, r.address, d.name as district_name
FROM restaurants r
JOIN districts d ON r.district_id = d.id;
```

### 2. Obtener reservaciones con información completa
```sql
SELECT 
    res.id,
    u.first_name || ' ' || u.last_name as client_name,
    rest.name as restaurant_name,
    d.name as district_name,
    res.reservation_date,
    res.number_of_people,
    res.total_amount,
    res.status
FROM reservations res
JOIN users u ON res.client_id = u.id
JOIN restaurants rest ON res.restaurant_id = rest.id
JOIN districts d ON rest.district_id = d.id;
```

### 3. Contar reservaciones por distrito
```sql
SELECT 
    d.name as district_name,
    COUNT(res.id) as total_reservations
FROM districts d
LEFT JOIN restaurants rest ON d.id = rest.district_id
LEFT JOIN reservations res ON rest.id = res.restaurant_id
GROUP BY d.id, d.name;
```

## 🔒 Integridad Referencial

✅ **Todas las foreign keys están configuradas con restricciones CASCADE**
✅ **Los datos de ejemplo respetan la integridad referencial**
✅ **Hibernate maneja automáticamente las relaciones**

## 📊 Datos de Ejemplo Incluidos

- **20 distritos** mexicanos
- **30 restaurantes** con relación a distritos
- **6 usuarios** de ejemplo
- **10 reservaciones** con relaciones a usuarios y restaurantes
